===============================================================================
-*- Install -*-
===============================================================================
# Disk (uefi+gpt)
    # partition
    fdisk
        g -> create a new empty GPT partition table
        # create esp
        n -> add a new partition
            1     -> partition number
            enter -> first sector(default)
            +550M -> last sector
        t -> change a partition type
            1     -> partition number
            1     -> partition type
                     (EFI System: C12A7328-F81F-11D2-BA4B-00A0C93EC93B)
        # create swap partition
        n -> add a new partition
            2     -> partition number
            enter -> first sector(default)
            +2G   -> last sector
        t -> change a partition type
            2     -> partition number
            19    -> partition type
                     (Linux swap: 0657FD6D-A4AB-43C4-84E5-0933C84B4F4F)
        # create root partition
        n -> add a new partition
            3     -> partition number
            enter -> first sector(default)
            enter -> last sector(default)
        t -> change a partition type
            3     -> partition number
            20    -> partition type
                     (Linux filesystem: 0FC63DAF-8483-4772-8E79-3D69D8477DE4)
        w

    # format file system
    mkfs.vfat /dev/sda1
    mkswap /dev/sda2
    mkfs.ext4 /dev/sda3

    # mount
    mount /dev/sda3 /mnt
    mkdir /mnt/boot
    mount /dev/sda1 /mnt/boot
    swapon /dev/sda2

# Disk (uefi+gpt+lvm)
    # show disk info
    lsblk
    blkid
    fdisk -l /dev/sda

    # partition
    fdisk
        g -> create a new empty GPT partition table
        # create esp
        n -> add a new partition
            1     -> partition number
            enter -> first sector(default)
            +550M -> last sector
        t -> change a partition type
            1     -> partition number
            1     -> partition type
                     (EFI System: C12A7328-F81F-11D2-BA4B-00A0C93EC93B)
        # create lvm partition
        n -> add a new partition
            2     -> partition number
            enter -> first sector(default)
            enter -> last sector(default)
        t -> change a partition type
            2     -> partition number
            31    -> partition type
                     (Linux LVM: E6D6D379-F807-44C2-A23C-238F2A3DF928)
        w

    # setup lvm
    lvmdiskscan
    pvcreate /dev/sda2
    pvdisplay
    vgcreate vg0 /dev/sda2
    vgdisplay
    lvcreate -L 2G vg0 -n swap
    lvcreate -l +100%FREE vg0 -n root
    lvdisplay

    # format file system
    mkfs.vfat /dev/sda1
    mkfs.ext4 /dev/mapper/vg0-root
    mkswap /dev/mapper/vg0-swap

    # mount
    mount /dev/mapper/vg0-root /mnt
    mkdir /mnt/boot
    mount /dev/sda1 /mnt/boot
    swapon /dev/mapper/vg0-swap

# Disk (bios + mbr)
    # partition
    fdisk
        o -> create a new empty DOS partition table
        # create swap partition
        n -> add a new partition
            p -> primary
            1 -> partition number
            enter -> first sector(default)
            +2G   -> last sector
        t -> change a partition type
            1     -> partition number
            82    -> partition type
                     (Linux Swap)
        # create root partition
        n -> add a new partition
            p -> primary
            2 -> partition number
            enter -> first sector(default)
            enter -> last sector(default)
        t -> change a partition type
            2     -> partition number
            83    -> partition type
                     (Linux)
        w

    # format file system
    mkswap /dev/sda1
    mkfs.ext4 /dev/sda2

    # mount
    mount /dev/sda2 /mnt
    swapon /dev/sda1

# Time
    timedatectl set-ntp true
    timedatectl set-local-rtc true

# Static Network
    systemctl stop dhcpcd@<interface>.service
    ip link set <interface> up
    ip addr add <ip>/24 dev <interface>
    ip route add default via <gateway>

# Select Mirror 
    vi /etc/pacman.d/mirrorlist

# Install base packages
    pacstrap /mnt base linux
    genfstab -U /mnt >> /mnt/etc/fstab
    arch-chroot /mnt

# Boot Loader (uefi+gpt)
    pacman -S grub efibootmgr
    grub-install --efi-directory=/boot --bootloader-id=grub
    grub-mkconfig -o /boot/grub/grub.cfg

# Boot Loader (uefi+gpt+lvm)
    vi /etc/mkinitcpio.conf
        HOOKS="base udev autodetect modconf block lvm2 filesystems keyboard fsck"
    mkinitcpio -p linux
    pacman -S grub efibootmgr
    grub-install --efi-directory=/boot --bootloader-id=grub
    grub-mkconfig -o /boot/grub/grub.cfg
        # Hang fix
        mkdir /mnt/hostlvm
        mount --bind /run/lvm /mnt/hostlvm
        arch-chroot /mnt
        ln -s /hostlvm /run/lvm

# Boot Loader (bios+mbr)
    pacman -S grub
    grub-install /dev/sda
    grub-mkconfig -o /boot/grub/grub.cfg

# Time
    timedatectl set-ntp true
    timedatectl set-local-rtc true
    ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

# Localization
    vi /etc/locale.gen
    locale-gen
    vi /etc/locale.conf
        LANG=en_US.UTF-8

# Network
    *. hostname
    vi /etc/hostname
        ArchDev
    vi /etc/hosts
        127.0.0.1 localhost
        ::1       localhost
        127.0.1.1 ArchDev

    *. wifi
    pacman -S wpa_supplicant

    *. use dhcpcd
    systemctl enable dhcpcd

    *. use systemd-networkd
    systemctl mask dhcpcd
    systemctl enable systemd-networkd.service
    systemctl enable systemd-resolved.service
    systemctl enable wpa_supplicant@<wireless_interface>.service
    systemctl start systemd-networkd.service
    systemctl start systemd-resolved.service
    systemctl start wpa_supplicant@<wireless_interface>.service
    vi /etc/systemd/resolved.conf
        LLMNR=no
    vi /etc/systemd/network/10-<wired_interface>.network
        [Match]
        Name=<interface>

        [Network]
        DHCP=ipv4
        DNS=8.8.8.8
        [DHCP]
        UseDNS=false
        RouteMetric=10

        [Network]
        Address=<ip>/<mask>
        Gateway=<gateway_ip>
        DNS=<DNS1>
        DNS=<DNS2>
        [Route]
        Metric=10
    vi /etc/systemd/network/20-<wireless_interface>.network
        [Match]
        Name=<interface>

        [Network]
        DHCP=ipv4
        [DHCP]
        RouteMetric=20
    vi /etc/wpa_supplicant/wpa_supplicant-<wireless_interface>.conf
        ctrl_interface=/var/run/wpa_supplicant
        ctrl_interface_group=root
        update_config=1
        network={
            ssid="<ssid_1>"
            psk="<psk_1>"
        }
        network={
            ssid="<ssid_2>"
            psk="<psk_2>"
        }
    wpa_cli
        scan
        scan_result
        status
        list_network
        add_network
        set_network <network_id> ssid "<ssid>"
        set_network <network_id> psk "<psk>"
        enable_network <network_id> 
        select_network <network_id>
        save_config

    *. use network-manager
    pacman -S NetworkManager
    systemctl mask dhcpcd
    systemctl enable wpa_supplicant.service
    systemctl start wpa_supplicant.service
    systemctl enable NetworkManager.service
    systemctl start NetworkManager.service
    nmtui
    nmcli connection
    nmcli connection modify <uuid> ipv4.route-metric 500
    nmcli connection modify <uuid> ipv6.route-metric 500
    ---------------------------------------------------------------------------

# Root Password
    passwd

# Dual Boot
    vi /etc/grub.d/40_custom
        menuentry 'Windows 10' {
            echo 'Loading Windows 10...'
            insmod part_gpt
            insmod fat
            insmod search_fs_uuid
            insmod chain
            search --fs-uuid --set=root $hints_string $fs_uuid
            chainloader /EFI/Microsoft/Boot/bootmgfw.efi
        }
    grub-probe --target=fs_uuid /boot/EFI/Microsoft/Boot/bootmgfw.efi
    grub-probe --target=hints_string /boot/EFI/Microsoft/Boot/bootmgfw.efi
    grub-mkconfig -o /boot/grub/grub.cfg

# Reinstall all packages
    pacman -Qeq | pacman -S -
    pacman -Qdq | pacman -S --asdeps -

===============================================================================
-*- Hardware -*-
===============================================================================
# disable Nvidia card
    pacman -S bbswitch
    vi /etc/modules-load.d/bbswitch.conf
        bbswitch
    vi /etc/modprobe.d/bbswitch.conf
        options bbswitch load_state=0
    vi /etc/modprobe.d/nouveau_blacklist.conf
        blacklist nouveau
    vi /etc/default/grub
        GRUB_CMDLINE_LINUX_DEFAULT="quiet acpi_osi=! acpi_osi=\"Windows 2009\""
    grub-mkconfig -o /boot/grub/grub.cfg

# hardware sensor
    pacman -S lm_sensors
    sensors-detect
    sensors

# wacom tablet
    pacman -S xf86-input-wacom
    xsetwacom list devices

# disk smart
    pacman -S smartmontools
    smartctl --info /dev/<device>

# usb writter
    dd if= of= conv=fsync oflag=direct status=progress

===============================================================================
-*- Server -*-
===============================================================================
pacman -S archlinux-keyring
pacman -S linux-lts
pacman -R linux
grub-mkconfig -o /boot/grub/grub.cfg

pacman -S net-tools
pacman -S openssh
pacman -S cronie

# ssh
    systemctl enable sshd
    vi /etc/ssh/sshd_config
        Port 22
        Listen 0.0.0.0
        PermitRootLogin no
    systemctl start sshd

# cronie
    systemctl enable cronie

# mode tcp_bbr
    modinfo tcp_bbr
    sysctl net.ipv4.tcp_congestion_control
    modeprobe tcp_bbr
    sysctl net.ipv4.tcp_congestion_control=bbr
    echo "tcp_bbr" > /etc/modules-load.d/tcp_bbr.conf
    echo "net.ipv4.tcp_congestion_control=bbr" > /etc/sysctl.d/tcp_bbr.conf

===============================================================================
-*- GUI -*-
===============================================================================
pacman -S xf86-video-vesa
pacman -S mesa vulkan-intel
pacman -S xf86-video-vmware xf86-input-vmmouse open-vm-tools
-------------------------------------------------------------------------------
pacman -S xorg-server xorg-xinit
-------------------------------------------------------------------------------
pacman -S alsa-utils
pacman -S pulseaudio
-------------------------------------------------------------------------------
pacman -S openbox
pacman -S tint2
pacman -S feh
pacman -S volumeicon
-------------------------------------------------------------------------------
pacman -S i3-wm
-------------------------------------------------------------------------------
pacman -S fcitx-im fcitx-googlepinyin fcitx-configtool
pacman -S thunar
pacman -S terminus-font
pacman -S ttf-dejavu
pacman -S noto-fonts noto-fonts-cjk noto-fonts-emoji
pacman -S wqy-microhei
pacman -S xterm rxvt-unicode sakura
pacman -S slock
pacman -S firefox
pacman -S virtualbox virtualbox-guest-iso
pacman -S ntfs-3g
-------------------------------------------------------------------------------
pacman -S transmission-gtk
pacman -S amule
pacman -S vlc
pacman -S evince
pacman -S blender
pacman -S gimp
-------------------------------------------------------------------------------
pacman -S freerdp
-------------------------------------------------------------------------------
vi /etc/vconsole.conf
    FONT=ter-122b

vi ~/.xinitrc
    export GTK_IM_MODULE=fcitx
    export QT_IM_MODULE=fcitx
    export XMODIFIERS="@im=fcitx"
    tint2 &
    fcitx &
    volumeicon &
    ~/.fehbg &
    exec openbox-session
-------------------------------------------------------------------------------
# reload tint2
    killall -SIGUSR1 tint2

# vmtools
    systemctl enable vmtoolsd

# amule
    amuleweb --write-config --host=localhost
             --password=password --admin-pass=anotherpassword
===============================================================================
-*- Audio -*-
===============================================================================
pacman -S alsa-utils

alsamixer
alsactl store
alsactl kill rescan

vi /etc/modeprobe.d/01-alsa.conf
    options snd slots=snd_hda_intel,snd_usb_audio
    options snd_hda_intel index=0
    options snd_usb_audio index=1

vi ~/.asoundrc
    defaults.pcm.!card 1
    defaults.ctl.!card 1

speaker-test -c 1

===============================================================================
-*- Package Manager -*-
===============================================================================
# install package
    pacman -S <package_name>

# remove package
    pacman -Rs <package_name>

# force reinstall package
    pacman -S --overwrite '*' <pacakge_name>

# check package info
    pacman -Qi [pacakge_name]

# check package integrity
    pacman -Qkk [package_name]

# list all foreign packages(eg: aur)
    pacman -Qm

# check file belongs to which package
    pacman -Qo <file>

# list all files owned by a given package
    pacman -Ql <package_name>

# list all user installed packages
    comm -23 <(pacman -Qqett | sort) \
             <(pacman -Qqg base -g base-devel | sort | uniq)

===============================================================================
-*- System Maintenance -*-
===============================================================================
# list failed state services
    systemctl --failed

# system error log
    journalctl -xe

# disable automatic mount /tmp on ram
    systemctl mask tmp.mount

===============================================================================
-*- Dev -*-
===============================================================================
pacman -S make
-------------------------------------------------------------------------------
pacman -S gcc
pacman -S go
-------------------------------------------------------------------------------
pacman -S jdk8-openjdk
pacman -S gradle
pacman -S android-udev
pacman -S gvfs-mtp
pacman -S lib32-gcc-libs lib32-zlib (for old android sdk)
-------------------------------------------------------------------------------

===============================================================================
-*- Trouble shooting -*-
===============================================================================
*. mesa-20 iris driver bug
    ESA_LOADER_DRIVER_OVERRIDE=i965 startx
